---
title: "Shiny Tutorial"
author: "Thomas Kirschstein"
date: "29 4 2021"
output: 
  ioslides_presentation:
    css: style.css
    logo: logo.png
    widescreen: true
    smaller: true
    self_contained: true
    incremental: false
runtime: shiny
---

```{r setup, include=FALSE, cache=TRUE}
knitr::opts_chunk$set(echo = FALSE)
library(png)
library(lubridate)
library(tidyverse)
library(DT)
library(knitr)
library(kableExtra)
library(shiny)
```


## Gliederung 

1. Einleitung
2. Aufbau & Struktur von Shiny Apps
3. Reaktivität & Interaktivität
4. Data Wrangling
5. Plotly & Leaflet

# Einleitung 
## Allgemeines & Ziel

> <font size="5.5">Shiny ist ein R-Paket zur Programmierung interaktiver Web-Applikationen.</font>

<br>

<div class="columns-2">

<font size="5">**Eigenschaften**:</font>

- nutzt R um Daten aufzubereiten und zu verarbeiten
- bietet Funktionen zum Umwandeln von R-Objekten in HTML-Objekten (HTML-Code kann auch direkt verarbeitet werden)
- reaktive Programmierung:  (User-)Input -> Verarbeitung -> Output


<br>

<font size="5">**Ziele für heute**:</font>

> - grundlegende Funktionsweise & Elemente 
> - Grundstrukturen reaktiver Programmierung 
> - Datenhandling (dynamisch vs. interaktiv, rhandsontables) 
> - hübsche Plots & Karten mit Plotly & Leaflet
> - alle Skripte und Inhalte verfügbar unter https://github.com/tkirschstein/shiny_tutorial

```{r, out.width = "99%", echo=F, fig.cap="Beispielapps"}
include_graphics("figures/examples_shiny.png")
```
[Shiny Gallery](https://shiny.rstudio.com/gallery/)
</div>

## Getting started

### Installation

```{r eval=FALSE, echo=TRUE, include=TRUE}
install.packages("shiny")
library(shiny)
```

### Grundstruktur von Shiny apps

```{r, out.width = "80%", echo=F, fig.cap="Struktur von shiny apps", fig.align='center'}
include_graphics("figures/struktur_shiny.png")
```

# Aufbau & Struktur von Shiny Apps 

## Slide with R Output

```{r, echo=FALSE}
inputPanel(
  selectInput("n_breaks", label = "Number of bins:",
          choices = c(10, 20, 35, 50), selected = 20),

  sliderInput("bw_adjust", label = "Bandwidth adjustment:",
          min = 0.2, max = 2, value = 1, step = 0.2)
)

renderPlot({
  hist(faithful$eruptions, probability = TRUE, breaks = as.numeric(input$n_breaks),
       xlab = "Duration (minutes)", main = "Geyser eruption duration")

  dens <- density(faithful$eruptions, adjust = input$bw_adjust)
  lines(dens, col = "blue")
})
```

<!-- New chapter -->

# Reaktivität & Interaktivität

## Slide with Plot

```{r pressure}
ui <- fluidPage(
           # Application title
           titlePanel("Old Faithful Geyser Data"),
           # Sidebar with a slider input for number of bins 
           sidebarLayout(
              sidebarPanel(
                 sliderInput("bins",
                             "Number of bins:",
                             min = 1,
                             max = 50,
                             value = 30)
              ),
              # Show a plot of the generated distribution
              mainPanel(
                 plotOutput("distPlot")
              )
           )
      )

server <- function(input, output) {

    values <<- reactiveValues(y = 31)
    
    observe({
        values$y <<- input$bins + 1
    })
    
    observe({
    
    output$distPlot <- renderPlot({
        
        # generate bins based on input$bins from ui.R
        x    <- faithful[, 2]
        
        bins <- seq(min(x), max(x), length.out = values$y)

        # draw the histogram with the specified number of bins
        hist(x, breaks = bins, col = 'darkgray', border = 'white')

    })
    })
    
}

shinyApp(ui = ui, server = server)
```

## Slide with controls

```{r echo = TRUE}
inputPanel(
selectInput("n_breaks2", label = "Number of bins:",
              choices = c(10, 20, 35, 50), selected = 20),
sliderInput("bw_adjust2", label = "Bandwidth adjustment:",
              min = 0.2, max = 2, value = 1, step = 0.2)
)
```

## Slide with result

```{r echo = FALSE}
renderPlot({
  hist(faithful$eruptions, probability = TRUE,
       breaks = as.numeric(input$n_breaks2),
       xlab = "Duration (minutes)",
       main = "Geyser eruption duration")

  dens <- density(faithful$eruptions, adjust = input$bw_adjust2)
  lines(dens, col = "blue")
})
```

## 2-column design {.columns-2}

